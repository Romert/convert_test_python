#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}üîç –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –≤ —Ñ–∞–π–ª)${NC}"
echo

# 1. –ó–∞–ø—Ä–æ—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
while true; do
    read -p "üìÅ –í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è): " target_dir
    target_dir="${target_dir:-.}"

    if [ -d "$target_dir" ]; then
        echo -e "${GREEN}‚úÖ –ö–∞—Ç–∞–ª–æ–≥ '$target_dir' –Ω–∞–π–¥–µ–Ω.${NC}"
        break
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –∫–∞—Ç–∞–ª–æ–≥ '$target_dir' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.${NC}"
    fi
done

# 2. –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤
echo
echo "üîé –ß—Ç–æ –∏—Å–∫–∞—Ç—å?"
echo "1) –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã"
echo "2) –¢–æ–ª—å–∫–æ –ø–∞–ø–∫–∏"
echo "3) –ò —Ñ–∞–π–ª—ã, –∏ –ø–∞–ø–∫–∏"
while true; do
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ (1/2/3): " choice
    case $choice in
        1)
            type_flag="-type f"
            desc="—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã"
            break
            ;;
        2)
            type_flag="-type d"
            desc="—Ç–æ–ª—å–∫–æ –ø–∞–ø–∫–∏"
            break
            ;;
        3)
            type_flag=""
            desc="—Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏"
            break
            ;;
        *)
            echo -e "${RED}–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥. –í–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ 3.${NC}"
            ;;
    esac
done

# 3. –í–æ–∑—Ä–∞—Å—Ç –≤ –º–µ—Å—è—Ü–∞—Ö
echo
read -p "üìÖ –í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –≤ –º–µ—Å—è—Ü–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2): " months
months="${months:-2}"

if ! [[ "$months" =~ ^[0-9]+$ ]]; then
    echo -e "${RED}‚ùå –í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2 –º–µ—Å—è—Ü–∞.${NC}"
    months=2
fi

days=$((months * 30))

# 4. –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
default_outfile="old_files_$(date +%Y%m%d_%H%M%S).txt"
read -p "üìÑ –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: $default_outfile): " outfile
outfile="${outfile:-$default_outfile}"

# –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é)
out_dir=$(dirname "$outfile")
if [ ! -d "$out_dir" ]; then
    echo -e "${RED}‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è '$out_dir' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–∑–¥–∞—Ç—å –µ—ë? (y/n): ${NC}"
    read -r confirm
    if [[ "$confirm" =~ ^[Yy]$ ]]; then
        mkdir -p "$out_dir" && echo -e "${GREEN}‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞.${NC}" || {
            echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.${NC}"
            exit 1
        }
    else
        echo -e "${RED}‚ùå –û—Ç–º–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.${NC}"
        exit 1
    fi
fi

# 5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
echo
echo -e "${YELLOW}–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫...${NC}"

cmd="find \"$target_dir\" $type_flag -mtime +$days"

# –í—ã–ø–æ–ª–Ω—è–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
eval "$cmd" > "$outfile"

# –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫
if [ -s "$outfile" ]; then
    count=$(wc -l < "$outfile")
    echo -e "${GREEN}‚úÖ –ù–∞–π–¥–µ–Ω–æ $count –æ–±—ä–µ–∫—Ç–æ–≤. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: $outfile${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω: $outfile${NC}"
fi

echo
echo -e "${GREEN}–ì–æ—Ç–æ–≤–æ!${NC}"
