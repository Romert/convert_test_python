#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}üîç –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫${NC}"
echo

# 1. –ó–∞–ø—Ä–æ—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
while true; do
    read -p "üìÅ –í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è): " target_dir
    target_dir="${target_dir:-.}"

    if [ -d "$target_dir" ]; then
        echo -e "${GREEN}‚úÖ –ö–∞—Ç–∞–ª–æ–≥ '$target_dir' –Ω–∞–π–¥–µ–Ω.${NC}"
        break
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –∫–∞—Ç–∞–ª–æ–≥ '$target_dir' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.${NC}"
    fi
done

# 2. –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤
echo
echo "üîé –ß—Ç–æ –∏—Å–∫–∞—Ç—å?"
echo "1) –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã"
echo "2) –¢–æ–ª—å–∫–æ –ø–∞–ø–∫–∏"
echo "3) –ò —Ñ–∞–π–ª—ã, –∏ –ø–∞–ø–∫–∏"
while true; do
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ (1/2/3): " choice
    case $choice in
        1)
            type_flag="-type f"
            echo -e "${GREEN}–í—ã–±—Ä–∞–Ω–æ: —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã${NC}"
            break
            ;;
        2)
            type_flag="-type d"
            echo -e "${GREEN}–í—ã–±—Ä–∞–Ω–æ: —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫–∏${NC}"
            break
            ;;
        3)
            type_flag=""
            echo -e "${GREEN}–í—ã–±—Ä–∞–Ω–æ: —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏${NC}"
            break
            ;;
        *)
            echo -e "${RED}–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥. –í–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ 3.${NC}"
            ;;
    esac
done

# 3. –í–æ–∑—Ä–∞—Å—Ç –≤ –º–µ—Å—è—Ü–∞—Ö
echo
read -p "üìÖ –í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –≤ –º–µ—Å—è—Ü–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2): " months
months="${months:-2}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤–≤–µ–¥–µ–Ω–æ —á–∏—Å–ª–æ
if ! [[ "$months" =~ ^[0-9]+$ ]]; then
    echo -e "${RED}‚ùå –í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2 –º–µ—Å—è—Ü–∞.${NC}"
    months=2
fi

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–µ—Å—è—Ü—ã –≤ –¥–Ω–∏ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ: 1 –º–µ—Å—è—Ü = 30 –¥–Ω–µ–π)
days=$((months * 30))

echo
echo -e "${YELLOW}–ò—â–µ–º –æ–±—ä–µ–∫—Ç—ã —Å—Ç–∞—Ä—à–µ $months –º–µ—Å—è—Ü–µ–≤ ($days –¥–Ω–µ–π) –≤ '$target_dir'...${NC}"
echo

# –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É find
cmd="find \"$target_dir\" $type_flag -mtime +$days"

# –í—ã–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
echo -e "${GREEN}–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞:${NC}"
echo "$cmd"
echo

# –í—ã–ø–æ–ª–Ω—è–µ–º –∏ –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
results=$(eval "$cmd")

if [ -z "$results" ]; then
    echo -e "${YELLOW}–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.${NC}"
else
    echo "$results"
    echo
    echo -e "${GREEN}‚úÖ –ù–∞–π–¥–µ–Ω–æ $(echo "$results" | wc -l) –æ–±—ä–µ–∫—Ç–æ–≤.${NC}"
fi

echo
echo -e "${GREEN}–ì–æ—Ç–æ–≤–æ!${NC}"
